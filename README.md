# LARA_AUBOi5_AG95

ROS packages for running Aubo i5 with DH Robotics AG95 gripper with Moveit and Gazebo.

### Tutorial
---

* Clone these into the src folder of your ROS workspace:

  ```
  # Update
  rosdep update
  sudo apt update
  sudo apt dist-upgrade
  
  # Dependencies to install MoveIt from source
  sudo apt install python3-wstool python3-catkin-tools clang-format-10 python3-rosdep
  
  # Make workspace
  mkdir -p ~/catkin_ws/src
  
  # Clone packages
  cd ~/catkin_ws/src
  git clone https://github.com/ian-chuang/LARA_AUBOi5_AG95.git 
  git clone https://github.com/ian-chuang/dh_gripper_ros.git # AG95 gripper description and drivers
  git clone https://github.com/ian-chuang/aubo_robot.git -b melodic # Aubo i5 description and drivers
  git clone https://github.com/ian-chuang/oculus_reader.git # Reading Meta Quest 2 Controllers
  
  # Clone gazebo plugins
  cd ~/catkin_ws/src
  mkdir gazebo_plugins
  cd gazebo_plugins
  git clone https://github.com/ian-chuang/gazebo-pkgs.git # grasping fix plugin
  git clone https://github.com/roboticsgroup/roboticsgroup_upatras_gazebo_plugins.git # mimic joint plugin
  git clone https://github.com/pal-robotics/realsense_gazebo_plugin.git -b melodic-devel # realsense simulation plugin
  
  # Install MoveIt from source
  cd ~/catkin_ws/src
  mkdir moveit
  wstool init moveit
  wstool merge -t moveit https://raw.githubusercontent.com/ros-planning/moveit/master/moveit.rosinstall
  wstool update -t moveit
  
  # Install ROS package dependencies
  cd ~/catkin_ws/src
  rosdep install -y --from-paths . --ignore-src --rosdistro melodic
  
  # Install other dependencies LARA uses
  sudo apt-get install ros-melodic-realsense2-camera # realsense drivers
  
  # Add aubo dependencies 
  sudo apt-get install gdebi
  wget http://archive.ubuntu.com/ubuntu/pool/main/p/protobuf/libprotobuf9v5_2.6.1-1.3_amd64.deb 
  sudo gdebi ./libprotobuf9v5_2.6.1-1.3_amd64.deb
  rm ./libprotobuf9v5_2.6.1-1.3_amd64.deb
  cd ~/catkin_ws/src
  sudo ln -s aubo_robot/aubo_driver/lib/lib64/config/libconfig.so.11 /usr/lib/libconfig.so.11
  sudo ln -s aubo_robot/aubo_driver/lib/lib64/log4cplus/liblog4cplus-1.2.so.5.1.4 /usr/lib/liblog4cplus-1.2.so.5.1.4
  sudo ldconfig
  
  # Build
  cd ~/catkin_ws
  catkin build
  source devel/setup.bash
  ```
  
* Fix random bugs when building (Let me know if you have trouble)

* Setup Meta Quest 2 Teleop: follow instructions here https://github.com/ian-chuang/oculus_reader/blob/main/README.md

* To run simulation and MoveIt:

  ```
  # launch simulation and moveit 
  roslaunch lara_moveit_config demo_gazebo.launch
  
  # spawn box in simulation
  roslaunch lara_description spawn_box.launch
  
  # run pick routine
  rosrun lara_manipulation pick_and_place.py
  ```
  
* Run Realtime Servoing Meta Quest 2 Teleop:
  
  ```
  # Make sure simulation and MoveIt is running
  
  # Switch from trajectory controller to position controller
  rosservice call /controller_manager/switch_controller "start_controllers:
  - 'arm_position_controller'
  stop_controllers:
  - 'arm_controller'
  strictness: 2"
  
  # Run realtime servoing server
  roslaunch lara_moveit_servo pose_tracker.launch
  
  # Run Meta Quest teleop
  rosrun oculus_reader pose_teleop.py
  ```
  
### Changes I did to get it working:
---

In Progress ignore below:

#### lara_description:
* Created aubo_i5_macro.xacro (Aubo i5 URDF macro with added joint transmissions)
* Created pgc140_macro.xacro (PGC140 Gripper URDF with added joint transmissions and mimic joint gazebo plugin)
* Created aubo_i5_pgc140.urdf.xacro (attaches gripper to arm and fixes to world and adds gazebo ros control plugin)
* Created display.launch (displays URDF model in RViz)

#### lara_moveit_config (auto-generated by moveit setup assistant):
* Created gazebo_controllers.yaml (defines arm and gripper controllers and pids for mimic joint gazebo plugin)
* Modified ros_controllers.yaml (tells moveit how to interface with gazebo controllers)
* Modified gazebo.launch (correctly load xacro as urdf, spawn controllers in gazebo_controllers.yaml)
